/* 
Data explotation and cleaning

*/

--Data Explotation for Bellabeat Casestudy 
-- Checking the data im working with 

Select *
from CaseStudy..dailyActivity_merged$
Order by 1,2

Select *
from CaseStudy..Fitness_trackers_updated$
order by 1,2

select *
from CaseStudy..sleepDay_merged$
order by 3,4

select *
from CaseStudy..weightLogInfo_merged$
order by 3,4

-- Checking how many times they loggedin during the given period

select count(ActivityDate) as LogInTimes, 
from CaseStudy..dailyActivity_merged$
order by 1

--Looking at sum of steps vs the calories for each id
-- Checking the activeness of each id during given period

select Distinct id , (max(TotalSteps)-min(totalsteps)) as Steps, ((max(calories) -min(calories))/max(calories))*100 as perc_diff_lossCalories
from CaseStudy..dailyActivity_merged$
group by Id 

-- the average distance covered

select Distinct id , AVG(convert(float,TrackerDistance)) as avg_distance
from CaseStudy..dailyActivity_merged$
group by Id 


--Checking the sleep pattern and amount of time spend sleeping or in bed
select Distinct id, AVG(totalminutesasleep) as avg_sleep
from CaseStudy..sleepDay_merged$
group by Id

-- Joining the tables 
--Join the tables to compare the relationship of the data

select dailyActivity_merged$.Id, dailyActivity_merged$.ActivityDate, dailyActivity_merged$.Calories, dailyActivity_merged$.TrackerDistance,dailyActivity_merged$.VeryActiveMinutes,dailyActivity_merged$.SedentaryMinutes ,sleepDay_merged$.TotalMinutesAsleep
from CaseStudy..dailyActivity_merged$
inner join CaseStudy..sleepDay_merged$
on dailyActivity_merged$.Id = sleepDay_merged$.Id

-- 
--using CTE to calculate the avarage veryActiveminutes and sedentaryminutesAsleep
-- To check the amount of time the spend actively excersing and the time they spend when relaxed

with fitness ( id, ActivityDate, Calories, TrackerDistance, VeryActiveMinutes, SedentaryMinutes, TotalMinutesAsleep)
as 
(

select dailyActivity_merged$.Id, dailyActivity_merged$.ActivityDate, dailyActivity_merged$.Calories, dailyActivity_merged$.TrackerDistance,dailyActivity_merged$.VeryActiveMinutes,dailyActivity_merged$.SedentaryMinutes ,sleepDay_merged$.TotalMinutesAsleep
from CaseStudy..dailyActivity_merged$
inner join CaseStudy..sleepDay_merged$
on dailyActivity_merged$.Id = sleepDay_merged$.Id
)

select id, AVG(veryActiveMinutes) as Avg_veryActive, AVG(TotalMinutesAsleep) as avg_Minutesleep
from fitness
Group by id


-- Looking at weight loss difference  and the fats 
select Distinct id, ((max(convert(float,weightkg)) -min(convert(float,weightkg)))) as HighestweightLoss
from CaseStudy..weightLogInfo_merged$
group by Id	


--looking at fitness tracker
--to check which device is mostly recommended

select BrandName,COUNT( DeviceType) as numberOfDevices
from CaseStudy..Fitness_trackers_updated$
group by BrandName


-- Highly recommended devices
-- Devices with good ratings and  avg days it last for


select ModelName, BrandName, rating,AverageBatteryLifeDays 
from casestudy..fitness_trackers_updated$
where rating >= 4.9
order by 1

--devices that last longer

select ModelName, BrandName, rating,AverageBatteryLifeDays 
from casestudy..fitness_trackers_updated$
where AverageBatteryLifeDays>15
and rating is not null
group by BrandName ,ModelName, rating,AverageBatteryLifeDays 

--- looking at devices that are manual or not

select Distinct id,count(ismanualreport)
from CaseStudy..weightLogInfo_merged$
where IsManualReport=1 
group  by id


select Distinct id, count(ismanualreport) as NotManualReport
from CaseStudy..weightLogInfo_merged$
where IsManualReport=0 
group by id
